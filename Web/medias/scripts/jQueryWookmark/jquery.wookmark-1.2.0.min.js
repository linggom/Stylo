/*!
jQuery wookmark plugin
@name jquery.wookmark.js
@author Christoph Ono (chri@sto.ph or @gbks)
@author Sebastian Helzle (sebastian@helzle.net or @sebobo)
@version 1.2.0
@date 05/24/2013
@category jQuery plugin
@copyright (c) 2009-2013 Christoph Ono (www.wookmark.com)
@license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
(function(t){var i,e,s;s=function(t,i){return function(){return t.apply(i,arguments)}},e={align:"center",container:t("body"),offset:2,autoResize:!1,itemWidth:0,flexibleWidth:0,resizeDelay:50,onLayoutChanged:void 0},i=function(){function i(i,h){var o=this;this.handler=i,this.columns=null,this.containerWidth=null,this.resizeTimer=null,this.direction="left",t.extend(!0,this,e,h),this.update=s(this.update,this),this.onResize=s(this.onResize,this),this.getItemWidth=s(this.getItemWidth,this),this.layout=s(this.layout,this),this.layoutFull=s(this.layoutFull,this),this.layoutColumns=s(this.layoutColumns,this),this.filter=s(this.filter,this),this.clear=s(this.clear,this),this.getActiveItems=s(this.getActiveItems,this),this.filterClasses={},i.each(function(i,e){if($item=t(e),itemFilterClasses=$item.data("filterClass"),"object"==typeof itemFilterClasses&&itemFilterClasses.length>0)for(i in itemFilterClasses)filterClass=t.trim(itemFilterClasses[i]).toLowerCase(),filterClass in o.filterClasses||(o.filterClasses[filterClass]=[]),o.filterClasses[filterClass].push($item[0])}),this.autoResize&&(t(window).bind("resize.wookmark",this.onResize),this.container.bind("refreshWookmark",this.onResize))}return i.prototype.update=function(i){t.extend(!0,this,i)},i.prototype.onResize=function(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},i.prototype.filter=function(i,e){var s,h,o,n,r=[],l=t();if(i=i||[],e=e||"or",i.length){for(s in i)n=t.trim(i[s].toLowerCase()),n in this.filterClasses&&r.push(this.filterClasses[n]);if("or"==e||1==r.length)for(s in r)l=l.add(r[s]);else if("and"==e){var a=0;for(s in r)r[s].length<r[a].length&&(a=s);var u,f,c=r[a],d=!0;for(s in c){f=c[s],d=!0;for(h in r)if(a!=h){u=!1;for(o in r[h])if(r[h][o]==f){u=!0;break}if(!u){d=!1;break}}d&&l.push(c[s])}}this.handler.not(l).addClass("inactive")}else l=this.handler;l.removeClass("inactive"),this.columns=null,this.layout()},i.prototype.getActiveItems=function(){return this.handler.not(".inactive")},i.prototype.getItemWidth=function(){var t=this.itemWidth,i=this.container.width(),e=this.handler.eq(0);if(void 0===this.itemWidth||0===this.itemWidth&&!this.flexibleWidth?t=e.outerWidth():"string"==typeof this.itemWidth&&this.itemWidth.indexOf("%")>=0&&(t=parseFloat(this.itemWidth)/100*i),this.flexibleWidth){var s=this.flexibleWidth;"string"==typeof s&&s.indexOf("%")>=0&&(s=parseFloat(s)/100*i-e.outerWidth()+e.innerWidth());var h=Math.floor(1+i/(s+this.offset)),o=(i-(h-1)*this.offset)/h;t=Math.max(t,Math.floor(o)),this.handler.css("width",t)}return t},i.prototype.layout=function(){if(this.container.is(":visible")){var t=this.getItemWidth()+this.offset,i=this.container.width(),e=Math.floor((i+this.offset)/t),s=0,h=0,o=this.getActiveItems();e=Math.min(e,o.length),s="left"==this.align||"right"==this.align?Math.floor((e/t+this.offset)/2):Math.round((i-(e*t-this.offset))/2),this.direction="right"==this.align?"right":"left",h=null!=this.columns&&this.columns.length==e?this.layoutColumns(t,s):this.layoutFull(t,e,s),this.container.css("height",h),void 0!==this.onLayoutChanged&&"function"==typeof this.onLayoutChanged&&this.onLayoutChanged()}},i.prototype.layoutFull=function(t,i,e){var s,h,o=0,n=0,r=this.getActiveItems(),l=r.length,a=null,u=null,f={position:"absolute"},c=[],d="left"==this.align?!0:!1;for(this.columns=[];i>c.length;)c.push(0),this.columns.push([]);for(;l>o;o++){for(s=r.eq(o),a=c[0],u=0,n=0;i>n;n++)a>c[n]&&(a=c[n],u=n);h=0==u&&d?0:u*t+e,f[this.direction]=h,f.top=a,s.css(f),c[u]+=s.outerHeight()+this.offset,this.columns[u].push(s)}return Math.max.apply(Math,c)},i.prototype.layoutColumns=function(t,i){for(var e,s,h,o,n=[],r=0,l=0;this.columns.length>r;r++)for(n.push(0),e=this.columns[r],o=r*t+i,l=0;e.length>l;l++)s=e[l],h={top:n[r]},h[this.direction]=o,s.css(h),n[r]+=s.outerHeight()+this.offset;return Math.max.apply(Math,n)},i.prototype.clear=function(){clearTimeout(this.resizeTimer),t(window).unbind("resize.wookmark",this.onResize),this.container.unbind("refreshWookmark",this.onResize)},i}(),t.fn.wookmark=function(t){return this.wookmarkInstance?this.wookmarkInstance.update(t||{}):this.wookmarkInstance=new i(this,t||{}),this.wookmarkInstance.layout(),this.show()}})(jQuery);